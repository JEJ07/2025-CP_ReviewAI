{% extends 'reviewai/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}ReviewAI{% endblock %}

{% block content %}

<!-- TERMS OF USE MODAL (FIRST VISIT ONLY) -->
<div id="termsModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-[9999] hidden px-4">
  <div class="bg-white max-w-lg w-full p-6 sm:p-8 rounded-2xl shadow-2xl animate-scale">
    <div class="flex items-center gap-3 mb-4 sm:mb-6">
      <div class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 sm:w-6 sm:h-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900">Terms of Use</h2>
    </div>

    <div class="space-y-3 sm:space-y-4 text-sm text-gray-600 max-h-64 sm:max-h-96 overflow-y-auto mb-4 sm:mb-6 pr-2">
      <p>
        By using ReviewAI, you acknowledge that this tool provides <strong class="text-blue-600">probabilistic analysis</strong> of online reviews.
        Results are generated using AI models and <strong class="text-blue-600">may not reflect absolute accuracy</strong>.
      </p>
      <p>
        ReviewAI is a <strong class="text-blue-600">supplementary tool</strong> to help identify potentially misleading reviews.
        Users should apply their own judgment before making purchasing decisions.
      </p>
      <p>
        You agree not to use ReviewAI for legal claims or actions based solely on AI-generated results.
        All use is at your own risk.
      </p>
      <p class="text-xs text-gray-500">
        Read our full 
        <a href="{% url 'reviewai:terms_of_use' %}" class="text-blue-600 hover:underline font-medium">Terms of Use</a> and 
        <a href="{% url 'reviewai:privacy_policy' %}" class="text-blue-600 hover:underline font-medium">Privacy Policy</a>.
      </p>
    </div>

    <button id="acceptTermsBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 sm:py-3 rounded-xl transition shadow-lg hover:shadow-xl text-sm sm:text-base">
      I Understand
    </button>
  </div>
</div>

<!-- Hero Section -->
<section class="py-8 sm:py-12 lg:py-16 rounded-xl mb-6 sm:mb-8 px-4" data-aos="fade-up">
  <div class="max-w-2xl mx-auto text-center">
    <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-3 sm:mb-4">Analyze Fake Reviews</h2>
    <p class="text-base sm:text-lg lg:text-xl text-gray-600 mb-6 sm:mb-8 px-2">
      Let our AI tell you what's real and what's not.
    </p>

    <!-- Platform Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-5 mb-8 sm:mb-10 max-w-3xl mx-auto">
      {% for s in stats %}
      <div class="bg-white rounded-xl shadow-md p-4 sm:p-5 border border-gray-100 transition-all hover:shadow-lg">
        <div class="flex items-center justify-center mb-2 sm:mb-3">
          <img src="{% static s.logo %}" alt="{{ s.name }}" 
                class="w-10 h-10 sm:w-12 sm:h-12 object-contain p-1 bg-gray-50 rounded-lg">
        </div>
        <div class="text-xl sm:text-2xl font-bold {{ s.text_color }} mb-1">{{ s.confidence }}%</div>
        <div class="text-xs sm:text-sm font-medium text-gray-500">Confidence Rate</div>
        <div class="mt-2 h-2 bg-gray-200 rounded-full overflow-hidden">
          <div class="h-full {{ s.color }} rounded-full" style="width: {{ s.confidence }}%"></div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Review Form -->
    <form id="reviewForm" class="flex flex-col sm:flex-row gap-3 justify-center mb-4">
      {% csrf_token %}
      <textarea
        id="reviewText"
        placeholder="Paste the product review text..."
        class="flex-1 h-20 sm:h-12 px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 resize-none text-sm sm:text-base"
        rows="1"
      ></textarea>
      <button
        type="submit"
        id="analyzeBtn"
        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200 whitespace-nowrap text-sm sm:text-base"
      >
        Analyze
      </button>
    </form>
    <p class="text-gray-500 mt-4 text-sm sm:text-base px-2">
      Helping <span class="font-semibold">millions</span> shop smarter, safer, and scam-free.
    </p>
  </div>
</section>

<!-- Results Section -->
<div id="result" class="hidden mb-8 sm:mb-12 px-4"></div>

<!-- Stats Section -->
<section class="py-8 sm:py-12 lg:py-16 rounded-xl px-4" data-aos="fade-right">
  <div class="max-w-3xl mx-auto">
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 sm:gap-8 text-center mb-6 sm:mb-8">
      <div>
        <div id="review-counter" class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-2">0</div>
        <div class="text-sm sm:text-base text-gray-600">Reviews Analyzed</div>
      </div>
      <div>
        <div class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-2">98%</div>
        <div class="text-sm sm:text-base text-gray-600">Accuracy Rate</div>
      </div>
      <div>
        <div class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-2">24/7</div>
        <div class="text-sm sm:text-base text-gray-600">AI Monitoring</div>
      </div>
    </div>
  </div>
</section>

<!-- How ReviewAI Works -->
<section class="py-8 sm:py-12 px-4" data-aos="fade-up">
  <div class="max-w-7xl mx-auto">
    <h2 class="text-2xl sm:text-3xl font-bold text-center text-dark mb-8 sm:mb-12">How ReviewAI Works</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-8">
      <div class="bg-white p-5 sm:p-6 rounded-lg shadow-sm text-center review-box">
        <div class="w-14 h-14 sm:w-16 sm:h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4">
          <i class="fas fa-paste text-primary text-xl sm:text-2xl"></i>
        </div>
        <h3 class="text-lg sm:text-xl font-semibold text-dark mb-2">Paste Review</h3>
        <p class="text-sm sm:text-base text-gray-600">Copy and paste the product review text you want to analyze into our system.</p>
      </div>
      <div class="bg-white p-5 sm:p-6 rounded-lg shadow-sm text-center review-box">
        <div class="w-14 h-14 sm:w-16 sm:h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4">
          <i class="fas fa-brain text-primary text-xl sm:text-2xl"></i>
        </div>
        <h3 class="text-lg sm:text-xl font-semibold text-dark mb-2">AI Analysis</h3>
        <p class="text-sm sm:text-base text-gray-600">Our advanced AI algorithms examine the review for authenticity patterns and red flags.</p>
      </div>
      <div class="bg-white p-5 sm:p-6 rounded-lg shadow-sm text-center review-box">
        <div class="w-14 h-14 sm:w-16 sm:h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4">
          <i class="fas fa-chart-pie text-primary text-xl sm:text-2xl"></i>
        </div>
        <h3 class="text-lg sm:text-xl font-semibold text-dark mb-2">Get Results</h3>
        <p class="text-sm sm:text-base text-gray-600">Receive a detailed breakdown of the review's authenticity score and potential concerns.</p>
      </div>
    </div>
  </div>
</section>

<!-- Supported Platforms -->
<section class="py-8 sm:py-12 lg:py-16 border-t border-gray-100 text-center px-4" data-aos="fade-up-right">
  <div class="max-w-5xl mx-auto">
    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-3 sm:mb-4">Supported Platforms</h2>
    <p class="text-sm sm:text-base text-gray-600 mb-8 sm:mb-10 px-2">
      ReviewAI works across all major e-commerce sites to help you shop smarter.
    </p>

    <div class="flex flex-wrap justify-center gap-6 sm:gap-8 lg:gap-10">
      <a href="https://www.shopee.ph" target="_blank" 
        class="flex flex-col items-center transform transition-transform duration-300 hover:scale-110 w-24 sm:w-28 lg:w-32">
        <img src="{% static 'reviewai/images/shopee.png' %}" 
            class="w-16 h-16 sm:w-20 sm:h-20 object-contain mb-2 rounded-xl shadow-sm bg-white p-2 sm:p-3" 
            alt="Shopee logo">
        <span class="text-sm sm:text-base font-medium text-gray-700">Shopee</span>
      </a>

      <a href="https://www.amazon.com" target="_blank" 
        class="flex flex-col items-center transform transition-transform duration-300 hover:scale-110 w-24 sm:w-28 lg:w-32">
        <img src="{% static 'reviewai/images/amazon.png' %}" 
            class="w-16 h-16 sm:w-20 sm:h-20 object-contain mb-2 rounded-xl shadow-sm bg-white p-2 sm:p-3" 
            alt="Amazon logo">
        <span class="text-sm sm:text-base font-medium text-gray-700">Amazon</span>
      </a>

      <a href="https://www.lazada.com.ph" target="_blank" 
        class="flex flex-col items-center transform transition-transform duration-300 hover:scale-110 w-24 sm:w-28 lg:w-32">
        <img src="{% static 'reviewai/images/laz.png' %}" 
            class="w-16 h-16 sm:w-20 sm:h-20 object-contain mb-2 rounded-xl shadow-sm bg-white p-2 sm:p-3" 
            alt="Lazada logo">
        <span class="text-sm sm:text-base font-medium text-gray-700">Lazada</span>
      </a>

      <a href="https://www.ebay.com" target="_blank" 
        class="flex flex-col items-center transform transition-transform duration-300 hover:scale-110 w-24 sm:w-28 lg:w-32">
        <img src="{% static 'reviewai/images/ebay.png' %}" 
            class="w-16 h-16 sm:w-20 sm:h-20 object-contain mb-2 rounded-xl shadow-sm bg-white p-2 sm:p-3" 
            alt="Ebay logo">
        <span class="text-sm sm:text-base font-medium text-gray-700">Ebay</span>
      </a>
    </div>
  </div>
</section>


<div class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3 mx-4 my-6" data-aos="fade-up-left"> 
  <svg class="w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 11v2m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
  </svg>
  <div>
    <div class="font-semibold text-blue-700 text-sm sm:text-base">Shop with Confidence</div>
    <div class="text-gray-700 text-xs sm:text-sm mt-1">
      ReviewAI empowers smarter shopping by analyzing reviews on all major e-commerce platforms, helping you avoid scams and make informed purchasing decisions.
    </div>
  </div>
</div>

<!-- Extension Installation -->
<section class="py-8 sm:py-12 lg:py-16 rounded-xl mt-5 px-4" data-aos="zoom-in">
  <div class="max-w-4xl mx-auto text-center">
    <header class="mb-8 sm:mb-10">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 sm:mb-4">Install ReviewAI Extension</h2>
      <p class="text-base sm:text-lg text-gray-700 max-w-2xl mx-auto px-2">
        Enhance your shopping experience directly in your browser! Download our extension and follow the simple steps below to install it manually.
      </p>
    </header>

    <!-- Coming Soon Banner -->
    <div class="mb-6 sm:mb-8 p-4 sm:p-6 bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-200 rounded-xl">
      <div class="flex flex-col sm:flex-row items-center justify-center mb-2 sm:mb-3 gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-8 sm:w-8 text-amber-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-amber-800 text-center">Chrome Web Store Version Coming Soon!</h3>
      </div>
      <p class="text-amber-700 text-sm sm:text-base px-2">
        We're working on getting ReviewAI approved for the Chrome Web Store. Soon you'll be able to install it with just one click! 
        In the meantime, you can manually install the extension using the steps below.
      </p>
    </div>

    <!-- DOWNLOAD EXTENSION -->
    <div class="mb-8 sm:mb-12">
      <a href="{% static 'reviewai/extension/ReviewAI-Extension1.0.1.zip' %}" download
         class="inline-flex items-center bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold px-6 sm:px-8 py-3 sm:py-4 rounded-xl shadow-lg transition-all duration-300 transform hover:-translate-y-1 text-sm sm:text-base">
         <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
         </svg>
          Download Extension Folder
      </a>
      <p class="text-xs sm:text-sm text-gray-500 mt-2">Secure • Free • No Registration Required</p>
    </div>

    <!-- Installation Guide -->
    <div class="bg-white border border-gray-200 rounded-2xl p-5 sm:p-8 text-left shadow-sm">
      <div class="flex items-center mb-4 sm:mb-6">
        <h3 class="text-xl sm:text-2xl font-bold text-gray-900">Installation Guide (Chrome)</h3>
      </div>
      
      <ol class="space-y-3 sm:space-y-4">
        <li class="flex items-start">
          <div class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-2 sm:mr-3 mt-0.5">1</div>
          <div>
            <p class="text-sm sm:text-base text-gray-700">Download the <a href="{% static 'reviewai/extension/ReviewAI-Extension1.0.1.zip' %}" class="text-blue-600 font-bold hover:underline">ReviewAI-Extension.zip</a> file above.</p>
          </div>
        </li>
        <li class="flex items-start">
          <div class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-2 sm:mr-3 mt-0.5">2</div>
          <div>
            <p class="text-sm sm:text-base text-gray-700">Extract the zip file to a folder on your computer.</p>
          </div>
        </li>
        <li class="flex items-start">
          <div class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-2 sm:mr-3 mt-0.5">3</div>
          <div>
            <p class="text-sm sm:text-base text-gray-700">Open <strong class="text-blue-600">Chrome</strong> and go to <code class="bg-gray-100 text-gray-800 px-2 py-0.5 sm:py-1 rounded-md text-xs sm:text-sm break-all">chrome://extensions/</code>.</p>
          </div>
        </li>
        <li class="flex items-start">
          <div class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-2 sm:mr-3 mt-0.5">4</div>
          <div>
            <p class="text-sm sm:text-base text-gray-700">Turn on <strong class="text-blue-600">Developer mode</strong> (toggle in the top-right corner).</p>
          </div>
        </li>
        <li class="flex items-start">
          <div class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-2 sm:mr-3 mt-0.5">5</div>
          <div>
            <p class="text-sm sm:text-base text-gray-700">Click <strong class="text-blue-600">"Load unpacked"</strong> and select the extracted folder.</p>
          </div>
        </li>
        <li class="flex items-start">
          <div class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-bold mr-2 sm:mr-3 mt-0.5">6</div>
          <div>
            <p class="text-sm sm:text-base text-gray-700">The ReviewAI icon will now appear in your browser toolbar.</p>
          </div>
        </li>
      </ol>

      <!-- notif msg -->
      <div class="mt-6 sm:mt-8 p-3 sm:p-4 bg-green-50 border border-green-200 rounded-lg">
        <div class="flex items-start">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 text-green-500 mt-0.5 mr-2 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
          <p class="text-xs sm:text-sm text-green-700">
            Once installed, ReviewAI will automatically analyze reviews while you browse products on supported platforms.
          </p>
        </div>
      </div>

      <!-- Video Tutorial -->
      <div class="mt-8 sm:mt-10 pt-6 border-t border-gray-200">
        <div class="flex items-center mb-3 sm:mb-4">
          <div class="w-7 h-7 sm:w-8 sm:h-8 bg-purple-100 rounded-full flex items-center justify-center mr-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 sm:h-4 sm:w-4 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h4 class="text-lg sm:text-xl font-bold text-gray-900">Step-by-Step Video Tutorial</h4>
        </div>
        {% if video_url %}
          <div class="aspect-w-16 aspect-h-9 rounded-xl overflow-hidden border border-gray-300">
            <video autoplay loop muted playsinline controls class="w-full h-full object-cover rounded-xl">
              <source src="{{ video_url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
        {% else %}
          <div class="aspect-w-16 aspect-h-9 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex flex-col items-center justify-center text-gray-500 border border-gray-300 p-6 sm:p-8 min-h-[200px]">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 sm:h-12 sm:w-12 text-gray-400 mb-2 sm:mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="text-center text-gray-600 font-medium text-sm sm:text-base">Video tutorial coming soon</p>
            <p class="text-xs sm:text-sm text-gray-500 mt-1 text-center px-2">We're working on a detailed video guide to help you install the extension</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_js %}
<style>
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
.animate-fadeIn { animation: fadeIn 0.3s ease-out; }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("termsModal");
    const acceptBtn = document.getElementById("acceptTermsBtn");

    if (!localStorage.getItem("reviewai_terms_accepted")) {
        modal.classList.remove("hidden");
        document.body.classList.add("overflow-hidden");
    }

    acceptBtn.addEventListener("click", () => {
        localStorage.setItem("reviewai_terms_accepted", "true");
        modal.classList.add("hidden");
        document.body.classList.remove("overflow-hidden");
    });
});
</script>

<script>
  document.body.dataset.authenticated = '{{ user.is_authenticated|yesno:"true,false" }}';
  window.djangoUrls = {
    predict: '{% url "reviewai:predict" %}',
    analyze: '{% url "reviewai:analyze" %}',
  };
  window.csrfToken = "{{ csrf_token }}";

  function shortNumber(n) {
    if (n >= 1_000_000) return (n / 1_000_000).toFixed(1).replace(/\.0$/, '') + 'M';
    if (n >= 1_000) return (n / 1_000).toFixed(1).replace(/\.0$/, '') + 'k';
    return n.toString();
  }

  async function fetchReviewCount() {
    try {
      const response = await fetch("/review-count/");
      const data = await response.json();
      const counter = document.getElementById("review-counter");
      counter.textContent = shortNumber(data.total_reviews) + "+";
    } catch (err) {
      console.error("Error fetching count:", err);
    }
  }

  fetchReviewCount();
  setInterval(fetchReviewCount, 5000);
</script>
<script src="{% static 'reviewai/js/review-analyzer.js' %}"></script>
{% endblock %}