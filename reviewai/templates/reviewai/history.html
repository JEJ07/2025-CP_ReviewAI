{% extends 'reviewai/base.html' %}
{% load timezone_tags %}

{% block title %}Analysis History - ReviewAI{% endblock %}



{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
    
    <!-- Enhanced Header with Gradient (matching dashboard) -->
    <div class="mb-8 sm:mb-10" data-aos="fade-down">
        <div class="relative overflow-hidden bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-2xl shadow-xl p-6 sm:p-8">
            <!-- Decorative background pattern -->
            <div class="absolute inset-0 opacity-10">
                <div class="absolute inset-0" style="background-image: radial-gradient(circle at 2px 2px, white 1px, transparent 0); background-size: 24px 24px;"></div>
            </div>
            
            <div class="relative flex flex-col sm:flex-row items-start sm:items-center justify-between">
                <div class="flex items-center gap-4 mb-4 sm:mb-0">
                    <div class="w-14 h-14 sm:w-16 sm:h-16 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center ring-4 ring-white/30">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-extrabold text-white mb-1">
                            Analysis History
                        </h1>
                        <p class="text-blue-100 text-sm sm:text-base flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            Your complete review analysis records ({{ total_reviews }} total)
                        </p>
                    </div>
                </div>
                
                <!-- Quick Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                    {% if reviews %}
                    <button type="button" onclick="exportUserHistoryToPDF()"
                       class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white border-2 border-white/30 px-4 py-2.5 rounded-xl font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Export to PDF
                    </button>
                    {% endif %}
                    <a href="{% url 'reviewai:analyze' %}" 
                       class="inline-flex items-center gap-2 bg-white hover:bg-gray-50 text-blue-600 px-5 py-2.5 rounded-xl font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Analyze New Review
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% if reviews %}
        <!-- Desktop Table View (hidden on mobile) -->
        <div class="hidden lg:block bg-white shadow-xl rounded-2xl overflow-hidden" data-aos="fade-up">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200" id="historyTable">
                    <!-- Table Header -->
                    <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">#</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Product</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Review Text</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Result</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Confidence</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Date</th>
                        </tr>
                    </thead>
                    
                    <!-- Table Body -->
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for review in reviews %}
                            {% with analysis=review.analyses.first %}
                            <tr class="hover:bg-gray-50 transition-colors group"
                                data-review-number="{{ reviews.start_index|add:forloop.counter0 }}"
                                data-product-name="{{ review.product_name }}"
                                data-review-text="{{ review.review_text }}"
                                data-result="{{ analysis.get_result_display|default:'Not Analyzed' }}"
                                data-confidence="{{ analysis.confidence_percentage|default:'-' }}"
                                data-date="{{ review.local_created_at|date:'M d, Y h:i A' }}">
                                <!-- Row Number -->
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-500">
                                    {{ reviews.start_index|add:forloop.counter0 }}
                                </td>
                                
                                <!-- Product Name -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-bold text-gray-900 max-w-xs truncate">
                                        {% if review.link %}
                                        <a href="{{ review.link }}" target="_blank" class="text-indigo-600 hover:text-indigo-800 hover:underline transition-colors">
                                            {{ review.product_name|truncatechars:30 }}
                                        </a>
                                        {% else %}
                                            {{ review.product_name|truncatechars:30 }}
                                        {% endif %}
                                    </div>
                                </td>
                                
                                <!-- Review Text -->
                                <td class="px-6 py-4">
                                    <div class="text-sm text-gray-600 max-w-md">
                                        <span title="{{ review.review_text }}" class="line-clamp-2">{{ review.review_text|truncatechars:60 }}</span>
                                    </div>
                                </td>
                                
                                <!-- Result Badge -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if analysis %}
                                    <span class="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-bold rounded-full shadow-sm
                                        {% if analysis.result == 'fake' or analysis.result == 'likely_fake' %}bg-red-100 text-red-800 ring-1 ring-red-200
                                        {% elif analysis.result == 'genuine' or analysis.result == 'likely_genuine' %}bg-green-100 text-green-800 ring-1 ring-green-200
                                        {% else %}bg-yellow-100 text-yellow-800 ring-1 ring-yellow-200{% endif %}">
                                        {% if analysis.result == 'fake' or analysis.result == 'likely_fake' %}
                                        {% elif analysis.result == 'genuine' or analysis.result == 'likely_genuine' %}
                                        {% else %}{% endif %}
                                        {{ analysis.get_result_display }}
                                    </span>
                                    {% else %}
                                    <span class="inline-flex px-3 py-1.5 text-xs font-bold rounded-full bg-gray-100 text-gray-800">
                                        Not Analyzed
                                    </span>
                                    {% endif %}
                                </td>
                                
                                <!-- Confidence -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if analysis %}
                                    <div class="flex items-center gap-2">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2 w-20">
                                            {% widthratio analysis.confidence_score 1 100 as confidence_percentage %}
                                            <div class="h-2 rounded-full transition-all duration-300
                                                {% if analysis.confidence_score >= 0.8 %}bg-green-500
                                                {% elif analysis.confidence_score >= 0.6 %}bg-yellow-500
                                                {% else %}bg-red-500{% endif %}"
                                                 style="width: {{ confidence_percentage }}%">
                                            </div>
                                        </div>
                                        <span class="text-sm font-bold text-gray-900">{{ analysis.confidence_percentage }}</span>
                                    </div>
                                    {% else %}
                                    <span class="text-sm text-gray-400">-</span>
                                    {% endif %}
                                </td>
                                
                                <!-- Date -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-semibold text-gray-900">{{ review.local_created_at|date:"M d, Y" }}</div>
                                    <div class="text-xs text-gray-500">{{ review.local_created_at|date:"h:i A" }}</div>
                                </td>
                            </tr>
                            {% endwith %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Mobile Card View (visible only on mobile) -->
        <div class="lg:hidden space-y-4" data-aos="fade-up">
            {% for review in reviews %}
                {% with analysis=review.analyses.first %}
                <div class="group border-l-4 {% if analysis.result == 'fake' or analysis.result == 'likely_fake' %}border-red-500{% elif analysis.result == 'genuine' or analysis.result == 'likely_genuine' %}border-green-500{% else %}border-yellow-500{% endif %} bg-white hover:bg-gray-50 rounded-r-xl transition-all duration-200 shadow-lg"
                     data-review-number="{{ reviews.start_index|add:forloop.counter0 }}"
                     data-product-name="{{ review.product_name }}"
                     data-review-text="{{ review.review_text }}"
                     data-result="{{ analysis.get_result_display|default:'Not Analyzed' }}"
                     data-confidence="{{ analysis.confidence_percentage|default:'-' }}"
                     data-date="{{ review.local_created_at|date:'M d, Y h:i A' }}">
                    <div class="p-4">
                        <!-- Row Number Badge -->
                        <div class="flex items-center justify-between mb-3">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-700">
                                #{{ reviews.start_index|add:forloop.counter0 }}
                            </span>
                            <span class="text-xs text-gray-500">{{ review.local_created_at|date:"M d, Y" }}</span>
                        </div>

                        <!-- Product Name -->
                        <div class="mb-3">
                            {% if review.link %}
                            <a href="{{ review.link }}" target="_blank" class="text-base font-bold text-gray-900 hover:text-blue-600 transition-colors line-clamp-2">
                                {{ review.product_name }}
                            </a>
                            {% else %}
                            <h3 class="text-base font-bold text-gray-900 line-clamp-2">{{ review.product_name }}</h3>
                            {% endif %}
                        </div>

                        <!-- Review Text -->
                        <p class="text-sm text-gray-600 mb-4 line-clamp-3">{{ review.review_text }}</p>

                        <!-- Result & Confidence -->
                        <div class="flex flex-col sm:flex-row sm:items-center gap-3">
                            {% if analysis %}
                            <!-- Result Badge -->
                            <span class="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-bold rounded-full shadow-sm w-fit
                                {% if analysis.result == 'fake' or analysis.result == 'likely_fake' %}bg-red-100 text-red-800 ring-1 ring-red-200
                                {% elif analysis.result == 'genuine' or analysis.result == 'likely_genuine' %}bg-green-100 text-green-800 ring-1 ring-green-200
                                {% else %}bg-yellow-100 text-yellow-800 ring-1 ring-yellow-200{% endif %}">
                                {% if analysis.result == 'fake' or analysis.result == 'likely_fake' %}
                                {% elif analysis.result == 'genuine' or analysis.result == 'likely_genuine' %}
                                {% else %}{% endif %}
                                {{ analysis.get_result_display }}
                            </span>

                            <!-- Confidence -->
                            <div class="flex items-center gap-2 flex-1">
                                <div class="flex-1 bg-gray-200 rounded-full h-2 max-w-[100px]">
                                    {% widthratio analysis.confidence_score 1 100 as confidence_percentage %}
                                    <div class="h-2 rounded-full transition-all duration-300
                                        {% if analysis.confidence_score >= 0.8 %}bg-green-500
                                        {% elif analysis.confidence_score >= 0.6 %}bg-yellow-500
                                        {% else %}bg-red-500{% endif %}"
                                         style="width: {{ confidence_percentage }}%">
                                    </div>
                                </div>
                                <span class="text-sm font-bold text-gray-900">{{ analysis.confidence_percentage }}</span>
                            </div>
                            {% else %}
                            <span class="inline-flex px-3 py-1.5 text-xs font-bold rounded-full bg-gray-100 text-gray-800">
                                Not Analyzed
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endwith %}
            {% endfor %}
        </div>

        <!-- Pagination Controls (consistent with dashboard) -->
        {% if reviews.has_other_pages %}
        <div class="mt-6 bg-white px-4 py-4 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-2xl shadow-lg" data-aos="fade-up" data-aos-delay="100">
            <!-- Mobile Pagination -->
            <div class="flex-1 flex justify-between sm:hidden">
                {% if reviews.has_previous %}
                    <a href="?page={{ reviews.previous_page_number }}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-semibold rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                        Previous
                    </a>
                {% endif %}
                {% if reviews.has_next %}
                    <a href="?page={{ reviews.next_page_number }}" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-semibold rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                        Next
                    </a>
                {% endif %}
            </div>
            
            <!-- Desktop Pagination -->
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-700">
                        Showing <span class="font-bold text-blue-600">{{ reviews.start_index }}</span> to <span class="font-bold text-blue-600">{{ reviews.end_index }}</span> of <span class="font-bold text-blue-600">{{ total_reviews }}</span> reviews
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-xl shadow-sm -space-x-px" aria-label="Pagination">
                        <!-- Previous Button -->
                        {% if reviews.has_previous %}
                            <a href="?page={{ reviews.previous_page_number }}" class="relative inline-flex items-center px-3 py-2 rounded-l-xl border border-gray-300 bg-white text-sm font-semibold text-gray-500 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                                <span class="sr-only">Previous</span>
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </a>
                        {% else %}
                            <span class="relative inline-flex items-center px-3 py-2 rounded-l-xl border border-gray-300 bg-gray-100 text-sm font-semibold text-gray-400 cursor-not-allowed">
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </span>
                        {% endif %}
                        
                        <!-- Page Numbers -->
                        {% for num in reviews.paginator.page_range %}
                            {% if num == reviews.number %}
                                <span class="relative inline-flex items-center px-4 py-2 border border-blue-500 bg-blue-600 text-sm font-bold text-white z-10">{{ num }}</span>
                            {% elif num > reviews.number|add:'-3' and num < reviews.number|add:'3' %}
                                <a href="?page={{ num }}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-semibold text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">{{ num }}</a>
                            {% elif num == 1 or num == reviews.paginator.num_pages %}
                                <a href="?page={{ num }}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-semibold text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">{{ num }}</a>
                            {% elif num == reviews.number|add:'-3' or num == reviews.number|add:'3' %}
                                <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-semibold text-gray-500">...</span>
                            {% endif %}
                        {% endfor %}
                        
                        <!-- Next Button -->
                        {% if reviews.has_next %}
                            <a href="?page={{ reviews.next_page_number }}" class="relative inline-flex items-center px-3 py-2 rounded-r-xl border border-gray-300 bg-white text-sm font-semibold text-gray-500 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                                <span class="sr-only">Next</span>
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </a>
                        {% else %}
                            <span class="relative inline-flex items-center px-3 py-2 rounded-r-xl border border-gray-300 bg-gray-100 text-sm font-semibold text-gray-400 cursor-not-allowed">
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </span>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
        {% endif %}

    {% else %}
        <!-- Empty State (matching dashboard style) -->
        <div class="text-center py-16 bg-white rounded-2xl shadow-xl" data-aos="fade-up">
            <div class="max-w-sm mx-auto">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                    <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">No Reviews Found</h3>
                <p class="text-gray-600 mb-6">You haven't analyzed any reviews yet. Start your first analysis now!</p>
                <a href="{% url 'reviewai:analyze' %}" 
                   class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Analyze Your First Review
                </a>
            </div>
        </div>
    {% endif %}
</div>

{% block extra_js %}
<script>
function exportUserHistoryToPDF() {
    Swal.fire({
        title: 'Generating PDF...',
        html: 'Please wait while we create your history report',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });

    try {
        if (typeof window.jspdf === 'undefined') {
            throw new Error('jsPDF library not loaded');
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('l', 'mm', 'a4'); // Landscape
        
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const margin = 15;

        // Header
        doc.setFillColor(59, 130, 246);
        doc.rect(0, 0, pageWidth, 35, 'F');
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(22);
        doc.setFont(undefined, 'bold');
        doc.text('Analysis History Report', margin, 15);
        
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        doc.text(new Date().toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        }), margin, 25);
        doc.text('Total Records: {{ total_reviews }}', pageWidth - margin, 25, { align: 'right' });

        // Collect data from page
        const rows = [];
        const reviewElements = document.querySelectorAll('[data-review-number]');
        
        if (reviewElements.length === 0) {
            throw new Error('No review data found on page');
        }
        
        reviewElements.forEach(el => {
            const productName = el.dataset.productName || 'N/A';
            const reviewText = el.dataset.reviewText || 'N/A';
            const result = el.dataset.result || 'N/A';
            const confidence = el.dataset.confidence || 'N/A';
            const date = el.dataset.date || 'N/A';
            
            // Truncate long text
            const truncatedProduct = productName.length > 35 ? productName.substring(0, 32) + '...' : productName;
            const truncatedReview = reviewText.length > 50 ? reviewText.substring(0, 47) + '...' : reviewText;
            
            rows.push([
                el.dataset.reviewNumber,
                truncatedProduct,
                truncatedReview,
                result,
                confidence,
                date
            ]);
        });

        // Check if autoTable is available
        if (typeof doc.autoTable !== 'function') {
            throw new Error('jsPDF autoTable plugin not loaded. Please refresh the page.');
        }

        // Generate table using autoTable
        doc.autoTable({
            startY: 40,
            head: [['#', 'Product', 'Review Text', 'Result', 'Confidence', 'Date']],
            body: rows,
            theme: 'grid',
            styles: {
                fontSize: 8,
                cellPadding: 3,
                overflow: 'linebreak',
                halign: 'left',
                valign: 'middle'
            },
            headStyles: {
                fillColor: [59, 130, 246],
                textColor: [255, 255, 255],
                fontStyle: 'bold',
                fontSize: 9,
                halign: 'center'
            },
            columnStyles: {
                0: { cellWidth: 12, halign: 'center' },  // #
                1: { cellWidth: 60 },                    // Product
                2: { cellWidth: 80 },                    // Review
                3: { cellWidth: 35, halign: 'center' },  // Result
                4: { cellWidth: 30, halign: 'center' },  // Confidence
                5: { cellWidth: 35 }                     // Date
            },
            alternateRowStyles: {
                fillColor: [245, 247, 250]
            },
            margin: { left: margin, right: margin },
            didDrawPage: function(data) {
                // Footer
                doc.setFontSize(8);
                doc.setTextColor(156, 163, 175);
                doc.setFont(undefined, 'normal');
                doc.text(
                    `ReviewAI History Report - Page ${doc.internal.getCurrentPageInfo().pageNumber}`,
                    pageWidth / 2,
                    pageHeight - 10,
                    { align: 'center' }
                );
            }
        });

        // Save PDF
        const filename = 'ReviewAI_History_' + new Date().toISOString().split('T')[0] + '.pdf';
        doc.save(filename);
        
        Swal.fire({
            icon: 'success',
            title: 'PDF Generated!',
            text: 'Your history report has been downloaded successfully.',
            timer: 3000,
            showConfirmButton: false
        });
        
    } catch (error) {
        console.error('PDF generation error:', error);
        Swal.fire({
            icon: 'error',
            title: 'Generation Failed',
            html: `<div class="text-left">
                <p class="font-semibold mb-2">Error: ${error.message}</p>
                <p class="text-sm text-gray-600">Please try:</p>
                <ul class="text-sm text-gray-600 list-disc pl-5 mt-2">
                    <li>Refresh the page</li>
                    <li>Check your internet connection</li>
                    <li>Ensure reviews are loaded</li>
                </ul>
            </div>`,
            confirmButtonText: 'Refresh Page',
            showCancelButton: true,
            cancelButtonText: 'Close'
        }).then((result) => {
            if (result.isConfirmed) {
                location.reload();
            }
        });
    }
}
</script>
{% endblock %}
{% endblock %}